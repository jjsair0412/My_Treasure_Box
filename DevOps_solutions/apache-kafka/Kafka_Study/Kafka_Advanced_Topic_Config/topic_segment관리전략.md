# topic 상세구성요소
## partition 과 segments
토픽은 파티션들로 만들어져 있습니다.

그리고 파티션은 , 여러개의 세그먼트로 구성되어 있습니다.

또 여러개의 세그먼트들은 , 각각 offset 번호가 특정 구간만큼 가지고 있는데 , 이때 ***마지막 세그먼트는 ACTIVE 세그먼트가 됩니다.***
- Active 세그먼트는 쓰이고있는 세그먼트를 의미하기에 , Kakfa broker에선 마지막 오프셋이 뭔지 알수가 없습니다.

***ACTIVE 세그먼트는 토픽에서 단 1개만이 존재합니다***

## 중요 세그먼트 설정들
### ***log.segment.bytes***
단일 세그먼트의 최대 바이트 크기
- default 1GB

default 구성시 , 각 세그먼트가 1GB가 될 때 마다 새 세그먼트가 생성됨

### ***log.segment.ms***
세그먼트가 꽉 차지않은 상태에서 세그먼트가 닫힐때까지의 시간
- default 일주일

default 구성시 , 각 세그먼트가 1GB가 되지 않아도 7일이 지나면 차지 않은 세그먼트는 닫히고 새로운 세그먼트가 생성

### 이 둘이 중요한 이유 , **로그 컴팩션**
Kafka는 각 세그먼트당 로그가 계속 쌓이게 됩니다.
- 로그컴팩션에 대한 내용은 아래 순서대로 쭉 이어짐
    - [1. topic log 관리전략](./topic_log_관리전략.md)


따라서 처리량이 너무 적다면 , 세그먼트에 용량이 많이남게 되고 , 로그 컴팩션이 덜 일어나게 되기에 로그관리에 있어 불리합니다.

    로그컴팩션 이란 , Kakfa에서 사용되는 용어입니다.

    Kafka는 분산 로그 시스템으로서, 메시지(이벤트)를 로그의 형태로 저장합니다. 이러한 로그는 시간이 지남에 따라 계속 누적되므로, 저장 공간을 효율적으로 관리하기 위한 방법이 필요합니다.

    이때 방법이 로그컴팩션 입니다.

    생성된 key-value 타입의 로그가 아래와 같다고 생각했을 때 ,

    key1, valueA
    key2, valueB
    key1, valueC
    key3, valueD
    key2, valueE

    로그 컴팩션을 적용하면, 위의 로그는 아래와 같이 변환됩니다.

    key1, valueC
    key3, valueD
    key2, valueE

    따라서 로그 컴팩션을 위함 이라는 말은 , Kafka에서 발생하는 로그를 최신 로그를 제외하고 삭제시킨다는것을 의미합니다.
