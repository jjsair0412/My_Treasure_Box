# Kafka 기본이론
## 문서 색인


## 토픽이란 ?
Kafka cluster에있는 데이터 스트림을 의미함.
- DB의 테이블과 비슷함

이름을 통해서 Kafka에서 토픽을 식별함.

Topic은 데이터 포멧을 다 지원함
- json , Avro , txt 다 보내도 상관없음.

Topic안에 있는 메세지들의 순서를 **데이터 스트림**이라고 함

데이터 스트림을 쿼리할 수 없지만 , 토픽을 읽고 쓰면서 꺼내올수있음.

## 파티션 && 오프셋
토픽들을 **파티션별로 분리**할 수 있음.
- 예를들어서 100개의 파티션으로 토픽 분리

분리된 파티션으로 메시지를 넣을 수 있음.

파티션 안의 메시지는 id값을 가지고 , 0부터 1씩 오르는데 이 값을 **오프셋**이라 함

Kafka안의 데이터는 지우거나 수정할수 없다.
- 불 가변성을 가진다.

## Producers
Kafka Topic에 메세지를 보내는 주체를 Producer 라 한다.

프로듀서는 LB를 통해서 특정 토픽 안에 파티션들에게 특정 알고리즘방식을 통해 메시지를 보내게 되기 때문에 , Kafka는 스케일링 한다.

### Producers : Message keys
프로듀서는 메시지에 키를 추가해서 토픽안의 여러 파티션에 값을 넣을 때 사용하게 된다.

key값이 null이라면 , 데이터는 라운드로빈 방식으로 메시지를 보낸다.

Key값이 null이 아니라면 , 프로듀서는 항상 같은 파티션에 메시지를 보내기 때문에 , 특정 필드에 대한 메시지 순서 설정을 해야 한다.

## Kafka Message Serializer
Kafka 메세지를 생성시키는 주체.

메시지를 보낼 때 , 프로듀서에서 평상시 객체를 byte 데이터 직렬화가 필요하다.
- 실제 123 , helloworld같은 문자나 숫자를 0101 인 2진 데이터로 직렬화하고 보내야 함.

**Kafka는 이런 Message Serializer를 통해 byte 데이터 직렬화를 해서 Kafka에 보내기 때문에 , 어떤 데이터 포멧을 가진 값이 오더라도 토픽에 보낼 수 있는것이다.**


## Kafka 주요 특징
**1. 불가변성**

일단 Kafka Topic 파티션에 데이터가 들어가면 , 수정하거나 제거될 수 없다.

**2. 데이터 저장 시간**

Kafka 안에 들어간 데이터는 Default 1주일동안만 데이터를 갖고있으며 , 그 시간이 지나면 제거된다.

**3. offset 의미**

파티션마다 오프셋은 중복될 수 있기 때문에 , 파티션별로 구분된다.

메세지의 순서는 한 파티션에서만 유효하다.

**4. 파티션 갯수**

Topic마다 원하는대로 파티션 개수를 조절할 수 있다.