# 무중단 배포
해당 문서는 k8s의 resource를 사용하여 무중단 배포의 기본 계념들을 공부한 결과를 정리한 문서입니다.

## Blue-Green 배포
만약 이미지 버전이 v1 -> v2 로 변경되어야 할 때 , 

파드의 앞쪽에는 서비스를 배치하고 , 새 버전을 실행하는 파드를 불러오는 동안 서비스는 파드의 이전 버전에 연결되어 있다가 , 

v2 버전, 새로운 버전의 파드가 올라오면 서비스가 v2 버전인 새 버전 파드에 연결하는 방식을 `Blue-Green 배포`라 합니다.

### 롤링 업데이트 - replicationcontroller 리소스에 한정 , deployment가 나온 이유
Blue-Green 에서 모든 파드로 한꺼번에 넘어가는게 아니라 , 한개씩 단계적으로 넘어가는 롤링 업데이트를 사용할 수 있습니다.

만약 v1 버전 파드가 3대 떠있다면 `(replicas = 3)` v1 파드 한대를 제거하고 v2로 변경시키고 , v1 두대 제거하고 v2 변경 ,, 이렇게 천천히 스케일업 스케일다운되며 업데이트

이 경우 서비스 파드 셀렉터에 이전 파드와 새 파드를 모두 포함시킴

수동으로 해당 작업을 수행하는건 번거롭고 어렵기에 `kubectl`로 롤링 업데이트를 수행할 수 있습니다.
>kubectl 명령어로 롤링업데이트 하는 방안은 오래된 방법 , 지금은 지원하지 않음.

***제거된 이유 ?***

**1. object를 k8s가 수정**

k8s가 파드 레이블과 레이블 셀렉터를 직접 수정하기 때문에 관리자 입장에서 예상치 못한 일이 일어남.

**2. kubectl 클라이언트가 작업의 주체**

`kubectl rolling-update ~` 명령어는 kubectl 클라이언트가 작업을 주도하기 때문에 k8s 마스터 대신 kubectl이 작업함.

만약 kubectl 클라이언트가 rolling-update 도중에 k8s cluster랑 연결이 끊긴다면 심각한 문제 발생
- 업데이트된 파드와 업데이트되지 않은 파드가 혼재되어 k8s에 배포될수 있음 ..

따라서 Deployment 