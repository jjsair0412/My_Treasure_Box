# CloudWatch
## Overview
- AWS에서 제공하는 AWS 서비스 / Application 모니터링 서비스

- Public 서비스
    - Interface Endpoint 또는 인터넷을 통해 접근해야함.
    - AWS Private 서비스에서 Public 서비스에 접근하기 위해선 , Interface Enpoint 또는 IGW를 통해 접ㄴ그해야 한다.

- 로그 / 지표 / 이벤트 등의 운영 데이터를 수집하여 시각화 처리
    - 경보를 통해 자동화 대응 가능

## 주요 기능
### 1. 지표(Metric) 수집
- 시간 순서별 데이터요소 집합
    - 다수의 데이터 포인트로 구성
- AWS 서비스 / Application 성능 모니터링 하기 위해 지표 생성
    - EC2, ASG, ELB, Route53, CloudFront 등 다양한 서비스에서 로그 전송 가능
    - CloudWatch Agent / API 활용하여 커스텀 지표 생성 가능
        - EX ) EC2 메모리 사용량 등 (EC2 메모리 사용량은 커스텀해서 만들어야 함)
- AWS 대부분 서비스들은 기본적으로 지표를 제공함.
- 리전 단위
- 15개월 이후 사라짐
    - 최대 15개월동안 보관됨.

#### 1.1 지표의 구성
- 지표는 **Namespace** 단위로 나뉘어짐.
    - CloudWatch의 컨테이너
    - 지표의 출신 혹은 성격에 따라 논리적으로 묶인 단위
    - AWS 서비스의 기본적인 지표는 AWS/{서비스_명} 형식
        - EX ) /aws/lambda ,,, /aws/ec2 ,,, /aws/rds ,,,
    - 필수로 지정해야함
        - Custom 지표를 만들기 위해선 Namespace를 생성해야 함.

- **Metric Name** : 지표에 대한 이름
    - 필수로 지정해야 함.
    - 지표들은 **데이터포인트(DataPoint)**로 구성됨
        - 데이터 포인트는 지표를 구성하는 시간-값 데이터 단위
        - 시간은 초 단위까지 구성됨.
        - ***UTC 기준으로 만드는게 권장됨.***
            - ***내부적 통계 혹은 알람 등에서 UTC 기준으로 활용되기에 UTC 안맞추면 에러 발생할 확률 높음***
        - 데이터포인트의 **Resolution**
            - 데이터가 얼마나 자주 수집되는지에 관한 계념
            - 기본적으로 60초 단위로 수집되며, High resolution 모드에서는 1초단위로 수집됨.
            - 이후 초 단위로 1, 5, 10, 30 혹은 60의 배수로 조회가 가능하다.
        - 데이터포인트의 **Period**
            - 데이터가 얼마만큼의 시간을 기준으로 묶여서 보여지는지에 관한 개념
            - 초단위로 1, 5, 10, 30 혹은 60배수로 조회가 가능
                - 60 초 단위 미만은 High resolution 모드에서 수집된 데이터에서만 가능
            - 데이터포인트의 보관기간은 Resoluction 값에 따라 달라짐
                - 보관 기간
                    - 60초 미만 : 최대 3시간
                    - 60초 : 15일
                    - 300초 : 63일
                    - 1시간(3600초) 는 455일(15개월)
                - 작은 단위 보관기간은 큰 단위로 계속 합쳐짐
                    - EX ) 1분 단위는 15일동안만 확인 가능 , 이후 15일이 지나면 5분단위로만 확인 가능 , 이후 63일이 지나면 1시간단위로만 확인 가능
                - ***주의 : 2주 이상 데이터가 업데이트 되지 않은 Metric일 경우, 콘솔에서 보이지 않음***
                    - AWS CLI로만 확인 가능

- ***차원(Dimension)***
    - CloudWatch에서는 서비스를 대상으로 모든 지표가 수집됨. 예를들어서 AWS/EC2 네임스페이스의 모든 지표가 수집됨.
    - ***이때 어떤 인스턴스에서 온 로그인지 파악이 가능해야 하기 때문에, key-value로 구성된 Dimension을 사용함.***
    - 최대 30개까지 할당 가능
    - Dimension은 조합이 가능함
        - EX ) Dimension : (Server=prod, Domain=Seoul) or (Server=dev)

### 2. 경보(Alarm)
- 수집된 지표 값에 따라 알림 생성 가능
    - 일정 수치(threshold)로 도달하거나 이상 / 이하일때 경보 발생
- 다양한 방법으로 대응 가능
    - SNS로 Lambda 또는 ChatOps 실행하여 슬랙 또는 이메일로 전달

- 경보는 3가지 상태를 가짐
    - **OK** : 정상
    - **Alarm** : 알람 상태
    - **INSUFFICIENT_DATA** : 알람 상태를 확인하기 위한 정보가 부족함. (예를들어 EC2가 실행된지 얼마 되지 않아서 데이터가 부족)
- 경보는 Metric의 Resoluction에 따라 경보주기가 변동됨.
    - 당연한 이야기. 수집주기에 따라서 알람이 많이뜰수도, 적게뜰수도 있음.
    - 민감한 정보라면 High Resoluction으로 설정하여 경보를 수행

### 3. 로그수집 및 관리
- ECS , Lambda , EC2 등의 로그를 모아서 Kinesis , S3 등으로 로그전달
- 혹은 자체적으로 쿼리 작성하여 사용 가능

### 4. 대시보드
- 수집된 로그로 대시보드 생성 가능
